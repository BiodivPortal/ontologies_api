%div.container
  %div.row
    %div.span3
      %ul.nav.nav-list.bs-docs-sidenav.affix.sidebar-nav
        %li
          %a{href: "#nav_home"} Home
        %li
          %a{href: "#nav_usage"} General Usage
        %li
          %a{href: "#nav_non_rest"} Search and Annotation Endpoints
          %ul.nav.nav-list
            %li
              %a{href: "#nav_search"} Classes Search
            %li
              %a{href: "#nav_annotator"} Annotator
            %li
              %a{href: "#nav_resource_index"} Resource Index
        %li
          %a{href: "#nav_resource_endpoints"} Resource Endpoints
          %ul.nav.nav-list
            %li
              %a{href: "#nav_media_types"} Media Types
              %ul.nav.nav-list
                -@metadata_all.each do |cls|
                  %li
                    %a{href: "#" + cls[1][:cls].name.split("::").last}= cls[1][:cls].name.split("::").last
        %li
          %a{href: "#nav_content_types"} Content Types


    %div.span9

      %h1#nav_home API Documentation
      %h2#nav_usage General Usage
      %p
        This API uses hypermedia to expose relationships between media types. The state of the application
        is driven by navigating these links.

      %h3 Common Parameters
      %table.table.table-striped.table-bordered
        %tr
          %th Parameter
          %th Possible Values
          %th Description
        %tr
          %td apikey
          %td {your api key}
          %td
            %p
              An API Key is required to access any API call. It can be provided in three ways:
              %ol
                %li Using the <code>apikey</code> query string parameter
                %li Providing an <code>Authorization</code> header: <code>Authorization: apikey token=your_apikey</code> (replace `your_apikey` with your actual key)
                %li When using a web browser to explore the API, if you provide your API Key once using method 1, it will be stored in a cookie for subsequent requests. You can override this by providing a different API Key in a new call.
        %tr
          %td include
          %td
            all<br/>
            {comma-separated list of attributes, EX: attr1,attr2}
          %td
            By default, the API will show a subset of the available attributes for a given media type.
            This behavior can be overridden by providing <code>include=all</code> to show all attributes
            or <code>include=attribute1,attribute2</code> to include a specific list. The API is optimized
            to return the default values, so overriding this can impact the performance of your request.
        %tr
          %td format
          %td
            json<br/>
            jsonp<br/>
            xml
          %td
            The API returns JSON as the default content type. This can be overridden by using the <code>format</code>
            query string parameter. The API also respects <code>Accept</code> header entries, with precedence given
            to the <code>format</code> parameter.

      %h2#nav_non_rest Search, Annotation, and Resource Index Endpoints

      %p Several endpoints are available for performing lookups for classes, annotations, and annotated resources. These endpoints are not strictly RESTful, but do return objects with links where relevant.

      %h3#nav_search Classes Search

      %p
        An endpoint for searching classes and their properties is available
        %ul
          %li
            Perform search
          %ul
            %li
              <span class="label label-info">GET</span> <code>/search?q={search query}</code>
            %li
              example:
              %a{href: "/search?q=melanoma"} /search?q=melanoma

      %h3#nav_annotator Annotator

      %p
        The Annotator endpoint will examine text input and return relevant classes. Currently, the annotator only returns direct annotations (hierarchy and mapping annoations are planned for a future release).
        %ul
          %li Annotate text
          %ul
            %li
              <span class="label label-info">GET</span> <code>/annotator?text={input text}</code>
            %li
              example:
              %a{href: "/annotator?text=Melanoma+is+a+malignant+tumor+of+melanocytes+which+are+found+predominantly+in+skin+but+also+in+the+bowel+and+the+eye."} /annotator?text=Melanoma+is+a+malignant+tumor+of+melanocytes+which+are+found+predominantly+in+skin+but+also+in+the+bowel+and+the+eye.

      %h3#nav_resource_index Resource Index

      %p
        The Resource Index contains a collection of annotated resources that can be searched by providing ontology acronyms with a corresponding class id or set of ids
        %ul
          %li
            Perform search
            %ul
              %li
                Single class
                %ul
                  %li
                    <span class="label label-info">GET</span> <code>/resource_index/search?classes[ontology_id1][classid1]</code>
                  %li
                    example:
                    %a{href: "/resource_index/search?classes[http%3A%2F%2Fdata.bioontology.org%2Fontologies%2FSNOMEDCT][http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FSNOMEDCT%2F2092003]"} /resource_index/search?classes[http%3A%2F%2Fdata.bioontology.org%2Fontologies%2FSNOMEDCT][http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FSNOMEDCT%2F2092003]
              %li
                Multiple classes, single ontology
                %ul
                  %li
                    <span class="label label-info">GET</span> <code>/resource_index/search?classes[ontology_id1][classid1,classid2]</code>
                  %li
                    example:
                    %a{href: "/resource_index/search?classes[SNOMEDCT][http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FSNOMEDCT%2F2092003,http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FSNOMEDCT%2F162573006]"} /resource_index/search?classes[http%3A%2F%2Fdata.bioontology.org%2Fontologies%2FSNOMEDCT][http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FSNOMEDCT%2F2092003,http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FSNOMEDCT%2F162573006]
              %li
                Multiple classes, multiple ontologies
                %ul
                  %li
                    <span class="label label-info">GET</span> <code>/resource_index/search?classes[ontology_id1][classid1]&classes[ontology_acronym2][classid1,classid2]</code>
                  %li
                    example:
                    %a{href: "/resource_index/search?classes[SNOMEDCT][http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FSNOMEDCT%2F2092003]&classes[MDR][http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FMDR%2F10025044]"} /resource_index/search?classes[http%3A%2F%2Fdata.bioontology.org%2Fontologies%2FSNOMEDCT][http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FSNOMEDCT%2F2092003]&classes[http%3A%2F%2Fdata.bioontology.org%2Fontologies%2FMDR][http%3A%2F%2Fpurl.bioontology.org%2Fontology%2FMDR%2F10025044]
          %li
            Parameters
            %ul
              %li
                Filtering & query behavior
                %ul
                  %li ontologies={ontology_id1,ontology_id2,ontology_id3}
                  %li semantic_types={semType1,semType2,semType3}
                  %li max_level={0..N}
                  %li mapping_types={automatic|manual}
                  %li resources={resource1,resource2}
                  %li exclude_numbers={true|false}
                  %li minimum_match_length={0..N}
                  %li include_synonyms={true|false}
                  %li include_offsets={true|false}
                  %li mode={union|intersection}
              %li
                Stop words
                %ul
                  %li exclude_words={word1,word2,word3}
                  %li excluded_words_are_case_sensitive={true|false}

      %h2#nav_resource_endpoints Resource Endpoints

      %p
        Endpoints for RESTful resources can be found below, specifically in the list of Media Types.
        Using the provided hypermedia links, you can navigate from resource to resource.
        Each Media Type has a corresponding collection URL (when available), a list of HTTP verbs that can
        be used to operate on the resources, a description of the resource (including available attributes),
        and a list of hypermedia links that can be found on each resource.

      %h2#nav_media_types Media Types

      %h3 Documentation
      :markdown
        The documentation below describes the media types that available in the API. Media types describe the types of
        resources available, including the HTTP verbs that may be used with them and the attributes that each resource
        contains.

        #### HTTP Verbs
        The API uses different verbs to support processing of resources. This includes things like creating or deleting
        individual resources or something more specific like parsing an ontology. Typically, the verbs will be used in
        conjunciton with the URL that represents the id for a given resource. Here is how we interpret the verbs:

        - <span class="label label-info">GET</span> Used to retreive a resource or collection of resources.
        - <span class="label label-info">POST</span> Used to create a resource when the server determines the resource's id.
        - <span class="label label-info">PUT</span> Used to create a resource when a client determines the resource's id.
        - <span class="label label-info">PATCH</span> Used to modify an existing resource. The attributes in a PATCH request will replace existing attributes.
        - <span class="label label-info">DELETE</span> Used to delete an existing resource.

        #### Available Media Types
      %ol
        -@metadata_all.each do |cls|
          %li
            %a{href: "#" + cls[1][:cls].name.split("::").last}= cls[1][:uri]

      -@metadata_all.each do |cls, type|
        -@metadata = type
        =render(:haml, "documentation/metadata".to_sym)

      %h2#nav_content_types Content Types

      :markdown
        The API returns JSON as the default content type. This can be overridden by using the `format`
        query string parameter with the value `json`, `jsonp`, or `xml`. The API also respects `Accept` header entries
        (EX: `application/json`, `application/xml`), with precedence given to the `format` parameter.

        #### JSON
        The default content type is JSON, specifically a variant called [JSON-LD](http://json-ld.org/),
        or JSON Linked Data. You can treat this variant like normal JSON. All JSON parsers will be able
        to parse the output normally. The benefit of JSON-LD is that it enables hypermedia links, and you
        will find these links exposed as URLs in attributes labeled `@id`, which correspond to the id of the
        parent resource, or in an array called `links`, which contains a hash of link types with corresponding URLs.

        Here is a sample output of the JSON response format:
        <pre class="prettyprint linenums lang-javascript" style="display: table; padding-right: 20px;">
        {
            "administeredBy": [
                "http://data.bioontology.org/user/nevada"
            ],
            "acronym": "ABA-API-TST",
            "name": "ABA Adult Mouse Brain",
            "@id": "http://data.bioontology.org/ontology/ABA-API-TST",
            "@type": "http://data.bioontology.org/metadata/Ontology",
            "links": {
                "metrics": "http://data.bioontology.org/ontologies/ABA-API-TST/metrics",
                "submissions": "http://data.bioontology.org/ontologies/ABA-API-TST/submissions",
                "classes": "http://data.bioontology.org/ontologies/ABA-API-TST/classes",
                "roots": "http://data.bioontology.org/ontologies/ABA-API-TST/classes/roots",
                "reviews": "http://data.bioontology.org/ontologies/ABA-API-TST/reviews"
            },
            "@context": {
                "@vocab": "http://data.bioontology.org/metadata/",
                "acronym": "http://omv.ontoware.org/2005/05/ontology#acronym",
                "name": "http://omv.ontoware.org/2005/05/ontology#name",
                "administeredBy": {
                    "@id": "http://data.bioontology.org/metadata/User",
                    "@type": "@id"
                }
            }
        }
        </pre>

        - Line 7 shows the id for the resource. Doing an HTTP GET on the id will retreive the resource.
        - Line 8 shows the media type (see below).
        - Line 9 starts the links hash.
        - Line 16 is the resource's context, which can be used to determine the type for lists of ids. For example, line 2 lists
          the ids for users who administer the ontology, which can be determined by looking for the `administeredBy` attribute
          in the `@context` hash.
        - If you are interested in the predicate URI values used in the resource, these can be deterined by looking up the
          attribute in the `@context` hash or by appending the value of `@vocab` (line 17) to an attribute name in cases where
          the attribute isn't listed specifically in the `@context`.

        #### XML
        XML is also available as an alternative content type.

      %p Here is sample output for the XML format:
      <pre class="prettyprint linenums lang-xml" style="display: table; padding-right: 20px;">
      :escaped
        <ontology>
          <administeredByCollection>
            <administeredBy>http://data.bioontology.org/user/nevada</administeredBy>
          </administeredByCollection>
          <acronym>ABA-API-TST</acronym>
          <name>ABA Adult Mouse Brain</name>
          <id>http://data.bioontology.org/ontology/ABA-API-TST</id>
          <links>
            <self href="http://data.bioontology.org/ontology/ABA-API-TST" rel="http://data.bioontology.org/metadata/Ontology"/>
            <metrics href="/ontologies/ABA-API-TST/metrics"/>
            <submissions href="/ontologies/ABA-API-TST/submissions" rel="http://data.bioontology.org/metadata/OntologySubmission"/>
            <classes href="/ontologies/ABA-API-TST/classes" rel="http://www.w3.org/2002/07/owl#Class"/>
            <roots href="/ontologies/ABA-API-TST/classes/roots" rel="http://www.w3.org/2002/07/owl#Class"/>
            <reviews href="/ontologies/ABA-API-TST/reviews" rel="http://data.bioontology.org/metadata/Review"/>
          </links>
        </ontology>
      </pre>

      :markdown
        - Line 8 starts the links section
        - Lines 9-14 list links by type. The `href` attribute contains the link location and the `rel` attribute defines the type
          of resource that will be found at that location.
        - Elements outside of the links can also contain `href` and `rel` attributes (coming soon...)

